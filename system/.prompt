## Prompt

bash_prompt_command() {
    # How many characters of the $PWD should be kept
    local pwdmaxlen=35
    # Indicate that there has been dir truncation
    local trunc_symbol=".."
    local dir=${PWD##*/}
    pwdmaxlen=$(( ( pwdmaxlen < ${#dir} ) ? ${#dir} : pwdmaxlen ))
    NEW_PWD=${PWD/#$HOME/\~}
    local pwdoffset=$(( ${#NEW_PWD} - pwdmaxlen ))
    if [ ${pwdoffset} -gt "0" ]
    then
        NEW_PWD=${NEW_PWD:$pwdoffset:$pwdmaxlen}
        NEW_PWD=${trunc_symbol}/${NEW_PWD#*/}
    fi
	GIT_INFO=$(parse_git_branch)
}

parse_git_branch() {
	local OUT=`git branch 2> /dev/null | sed -e '/^[^*]/d' -e 's/* \(.*\)/\1/'`
	if [ "$OUT" != "" ]; then echo " $OUT"; fi
}

bash_prompt() {
    case $TERM in
        xterm*|rxvt*)
            local TITLEBAR='\[\033]0;${NEW_PWD}\007\]'
        ;;
        *)
            local TITLEBAR=""
        ;;
    esac

	PS1="$TITLEBAR${YELLOW}[${GREEN}\u${GREEN} ${YELLOW}\${NEW_PWD}${YELLOW}${GREEN}\${GIT_INFO}${GREEN}${YELLOW}]${WHITE} \\$ ${NORMAL}"
}

PROMPT_COMMAND=bash_prompt_command
bash_prompt
unset bash_prompt
